{% load static %}
<div class="modal-header" style="background-color: rgb(66, 108, 140);"></div>
<div class="modal-body">
    <h2>Transportista</h2>
    <form method="post" action={{actualizarTransportistaG}} id="actualizarTransportistaG">
        {% csrf_token %}
        <input type="hidden" id="arregloTipos" name="arregloTipos" value="">

        <div class="row">
            <div class="col-lg-4 col-md-4">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>Razon Social</label>
                    {{ form.RazonSocial }}
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>Nombre Comercial</label>
                    {{ form.NombreComercial }}
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>RFC</label>
                    {{ form.RFC }}
                </div>
            </div>
        </div>
    
        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>Prioridad</label>
                    {{ form.IDPrioridad }}
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>Estatus</label>
                    {{ form.IDEstatus }}
                </div>
            </div>
            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label has-error">
                    <label>Pagina Web</label>
                    {{ form.PaginaWeb }}
                </div>
            </div>
        </div>
        <br>

        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Municipio</label>
                    {{ form.Municipio }}
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Estado</label>
                    {{ form.Estado }}
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Pais</label>
                    {{ form.Pais }}
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Codigo Postal</label>
                    {{ form.CodigoPostal }}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Calle</label>
                    {{ form.Calle }}
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Numero Exterior</label>
                    {{ form.NumeroExt }}
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Numero Interior</label>
                    {{ form.NumeroInt }}
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                <div class="form-group form-md-line-input">
                    <label>Colonia</label>
                    {{ form.Colonia }}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Tipo</label>
                    <div id="contenedorTipos"></div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Seguridad(%)</label>
                    {{ form.Seguridad }}
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Poliza Seguro</label>
                    {{ form.PolizaSeguro }}
                </div>
            </div>
            <div class="col-lg-2T col-md-2 col-sm-2 col-xs-12">
                <div class="form-group form-md-line-input form-md-floating-label">
                    <label>Credito</label>
                    {{ form.Credito }}
                </div>
            </div>
        </div>
        <div style="margin-top: 5px;">
            <button type="submit" class="btn btn-primary">Actualizar</button>
            <button type="button" style="float:right;" class="btn btn-default" data-dismiss="modal" >Cerrar</button>
        </div>
    </form>
</div>
<script>
    function mayusculas(e) {
        e.value = e.value.toUpperCase();
    }

    function sinEspacios(e){
        return ((e.which != 32))
    }

    function soloNumeros(e, event) {
        texto = document.getElementById(e.id).value;
        simbolo = event.key;
        cadena = texto+simbolo;

        if(event.key == "Backspace" ||  event.key == "ArrowLeft" || event.key == "ArrowRight"){
            return true;
        }

        var RE = /^[0-9]+$/;
        if (RE.test(cadena)){
            return true;
        }
        else{
            return false;
        }
    }

    function soloNumerosEspecial(e, event) {
        texto = document.getElementById(e.id).value;
        simbolo = event.key;
        cadena = texto+simbolo;

        if(event.key == "Backspace" ||  event.key == "ArrowLeft" || event.key == "ArrowRight"){
            return true;
        }

        var RE = /^[0-9]+$/;
        if (RE.test(cadena)){
            if(parseInt(cadena)<=100){
                return true;
            }
            else{
                return false;
            }
        }
        else{
            return false;
        }
    }

    function buscarEstadoMunicipio(e) {
        var cadena = e.value;
        var cp = document.getElementById("id_CodigoPostal");
        var colonia = document.getElementById("id_Colonia");

        if(cadena.length==5){
            url = 'https://api-sepomex.hckdrk.mx/query/info_cp/' + e.value;
            $.ajax({
                type: 'GET',
                url: url,
                success: function (data) {
                    document.getElementById("id_Estado").value = data[0].response.estado;
                    document.getElementById("id_Municipio").value = data[0].response.municipio;
                    document.getElementById("id_Pais").value = data[0].response.pais;

                    $(colonia).empty();
                    $(colonia).append($('<option>').text('Colonia').attr('value',"Colonia"));

                    for(var cont=0; cont < data.length; cont++){
                        $(colonia).append($('<option>').text(data[cont].response.asentamiento).attr('value',data[cont].response.asentamiento));
                    }
                }
            });
        }
        else{
            document.getElementById("id_Estado").value = "";
            document.getElementById("id_Municipio").value = "";
            document.getElementById("id_Pais").value = "";
            colonia = document.getElementById('id_Colonia');
            $(colonia).empty();
            $(colonia).append($('<option>').text('Colonia').attr('value',"Colonia"));
            document.getElementById().selectedIndex = 0;
        }        
    }

    var banderaActualizar = 1;
    $('#actualizarTransportistaG').on('submit', function(event) {
        razonSocial = document.getElementById("id_RazonSocial").value;
        nombreComercial = document.getElementById("id_NombreComercial").value;
        rfc = document.getElementById("id_RFC").value;
        prioridades = document.getElementById("id_IDPrioridad").value;
        estatus = document.getElementById("id_IDEstatus").value;
        paginaWeb = document.getElementById("id_PaginaWeb").value;
        municipio = document.getElementById("id_Municipio").value;
        estado = document.getElementById("id_Estado").value;
        pais = document.getElementById("id_Pais").value;
        CPPostal = document.getElementById("id_CodigoPostal").value;
        calle = document.getElementById("id_Calle").value;
        numeroExt = document.getElementById("id_NumeroExt").value;
        numeroInt = document.getElementById("id_NumeroInt").value;
        colonia = document.getElementById("id_Colonia").value;
        //tipo = document.getElementById("id_IDTipo").value;
        seguridad = document.getElementById("id_Seguridad").value;
        polizaSeguro = document.getElementById("id_PolizaSeguro").value;
        credito = document.getElementById("id_Credito").value;

        if(banderaActualizar == 0){
            return false;;
        }

        if(razonSocial == ""){
            alert("¡Falta la rason social!");
            return false;
        }

        if(nombreComercial == ""){
            alert("¡Falta el nombre comercial!");
            return false;
        }

        if(rfc.length!=13){
            alert("¡RFC incompleto debe de contener 13 caracteres!");
            return false;
        }

        if(prioridades==0){
            alert("¡Falta seleccionar una prioridad valida!");
            return false;
        }

        if(estatus==0){
            alert("¡Falta seleccionar un estatus valido!");
            return false;
        }

        if(paginaWeb == ""){
            alert("¡Falta la pagina web!");
            return false;
        }

        if(municipio == ""){
            alert("¡Falta el municipio!");
            return false;
        }

        if(estado == ""){
            alert("¡Falta el estado!");
            return false;
        }

        if(pais == ""){
            alert("¡Falta el pais!");
            return false;
        }

        if(CPPostal == ""){
            alert("¡Falta el codigo postal!");
            return false;
        }

        if(calle == ""){
            alert("¡Falta la calle!");
            return false;
        }

        if(numeroExt == ""){
            alert("¡Falta el numero exterior!");
            return false;
        }

        if(numeroInt == ""){
            alert("¡Falta el numero interior!");
            return false;
        }

        if(colonia == "Colonia"){
            alert("¡Falta seleccionar una colonia valida!");
            return false;
        }

        if(seguridad == ""){
            alert("¡Falta la seguridad!");
            return false;
        }

        if(polizaSeguro == ""){
            alert("¡Falta la pliza de seguro!");
            return false;
        }

        if(credito == ""){
            alert("¡Falta el credito!");
            return false;
        }

        var arregloTipos = [];
        $("input[name=checkbox]").each(function (index) {  
            if($(this).is(':checked')){
                arregloTipos.push($(this).val());
            }
        });
        document.getElementById("arregloTipos").value = arregloTipos;

        var form = $(this);
        banderaActualizar = 0;
        $.ajax({
            url: form.attr("action"),
            data: form.serialize(),
            type: form.attr("method"),
            datatype: 'json',
            success: function(data){
                if(data.bandera == 2){
                    document.getElementById("id_RazonSocial").value = "";
                    document.getElementById("id_NombreComercial").value = "";
                    document.getElementById("id_RFC").value = "";
                    document.getElementById("id_IDPrioridad").selectedIndex  = 0;
                    document.getElementById("id_IDEstatus").selectedIndex = 0;
                    document.getElementById("id_PaginaWeb").value = "";
                    document.getElementById("id_Municipio").value = "";
                    document.getElementById("id_Estado").value = "";
                    document.getElementById("id_Pais").value = "";
                    document.getElementById("id_CodigoPostal").value = "";
                    document.getElementById("id_Calle").value = "";
                    document.getElementById("id_NumeroExt").value = "";
                    document.getElementById("id_NumeroInt").value = "";
                    colonia=document.getElementById('id_Colonia');
                    $(colonia).empty();
                    $(colonia).append($('<option>').text('Colonia').attr('value',"Colonia"));
                    colonia.selectedIndex = 0;
                    document.getElementById("id_IDTipo").selectedIndex = 0;
                    document.getElementById("id_Seguridad").value = "";
                    document.getElementById("id_PolizaSeguro").value = "";
                    document.getElementById("id_Credito").value = "";
                    alert("¡El trasnportista ya existe!");
                    banderaActualizar = 1;
                }
                else if(data.bandera == 3){
                    tablaTransportistasG();
                    $("#TransportistaModalG").modal("hide");
                }
                else if(data.bandera == 4){
                    document.getElementById("id_RazonSocial").value = "";
                    document.getElementById("id_NombreComercial").value = "";
                    document.getElementById("id_RFC").value = "";
                    document.getElementById("id_IDPrioridad").selectedIndex  = 0;
                    document.getElementById("id_IDEstatus").selectedIndex = 0;
                    document.getElementById("id_PaginaWeb").value = "";
                    document.getElementById("id_Municipio").value = "";
                    document.getElementById("id_Estado").value = "";
                    document.getElementById("id_Pais").value = "";
                    document.getElementById("id_CodigoPostal").value = "";
                    document.getElementById("id_Calle").value = "";
                    document.getElementById("id_NumeroExt").value = "";
                    document.getElementById("id_NumeroInt").value = "";
                    colonia=document.getElementById('id_Colonia');
                    $(colonia).empty();
                    $(colonia).append($('<option>').text('Colonia').attr('value',"Colonia"));
                    colonia.selectedIndex = 0;
                    document.getElementById("id_IDTipo").selectedIndex = 0;
                    document.getElementById("id_Seguridad").value = "";
                    document.getElementById("id_PolizaSeguro").value = "";
                    document.getElementById("id_Credito").value = "";
                    alert("¡Validacion erronea en el formulario!");
                    banderaActualizar = 1;
                }
            }
        });
        return false;
    });
</script>